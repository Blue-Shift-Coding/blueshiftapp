{% extends 'layouts/main.html' %}
{% block title %}Our Classes{% endblock %}
{% block page_header %}{{ super() }}{% endblock %}
{% block content %}


<section class="mainContent full-width clearfix">
	<div class="container">
		<div class="row">
			<div class="col-xs-12 filters">

				<span class="filters-label">Filter</span>

				<div class="dropdown classes-filter" data-filtername="dates" data-defaultvalue="" data-defaultlabel="All dates">
				  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenuDates" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
					<span class="selected-item" data-filtervalue=""></span>
					<span class="caret"></span>
				  </button>
				  <ul class="dropdown-menu" aria-labelledby="dropdownMenuDates">
					<li><a href="#" class="default-option"></a></li>
					<li role="separator" class="divider"></li>
					{% for date in dates %}
					<li><a href="javascript:void(0)" data-filtervalue="{{ date }}">{{ date }}</a></li>
					{% endfor %}
				  </ul>
				</div>


				<div class="dropdown classes-filter" data-filtername="ages" data-defaultvalue="" data-defaultlabel="All ages">
				  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenuAges" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
					<span class="selected-item" data-filtervalue=""></span>
					<span class="caret"></span>
				  </button>
				  <ul class="dropdown-menu" aria-labelledby="dropdownMenuAges">
					<li><a href="javascript:void(0)" class="default-option"></a></li>
					<li role="separator" class="divider"></li>
					{% for age in ages %}
					<li><a href="javascript:void(0)" data-filtervalue="{{ age }}">{{ age }}</a></li>
					{% endfor %}
				  </ul>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12 classes-results">

				{% for product in products %}

					{# color number must be between 1 and 6 - map to maximum age #}
					{% set color_number = product.max_age - 5 if product.max_age and product.max_age < 12 else 6  %}
					<div class="media courseList couresListPage">
						<a class="media-left border-color-{{ color_number }}" href="course-single-left-sidebar.html">
							<img class="media-object" src="{{ product.image }}" alt="Image">

							{# TODO:WV:20170506:Format currency properly #}
							<span class="sticker bg-color-{{ color_number }}">&pound;{{product.product_price|round|int}}</span>
						</a>
						<div class="media-body">
							<h3 class="media-heading"><a href="course-single-left-sidebar.html" class="color-{{ color_number }}">{{product.product_name}}</a></h3>

							<ul class="list-inline">
								<li><i class="fa fa-calendar-o" aria-hidden="true"></i>Age: {{ product.min_age|string+" to" if product.min_age else "" }} {{ product.max_age if product.max_age else "Adults" }}</li>
								{% if product.times %}
								<li><i class="fa fa-clock-o" aria-hidden="true"></i>{{ product.times|join(', ') }}</li>
								{% endif %}
							</ul>

							{{product.product_desc|safe}}
							<ul class="list-inline btn-yellow btnPart">
								<li>

									<a target="_blank" data-toggle="modal" data-target="#add-product-{{ product.id }}" class="btn btn-primary ">
										Book now
									</a>

									{# TODO:WV:20170531:Avoid duplicating this div in each product #}
									<div id="add-product-{{product.id}}" class="modal fade" role="dialog">
									  <div class="modal-dialog">
										<div class="modal-content">
										  <div class="modal-header">
											<button type="button" class="close" data-dismiss="modal">&times;</button>
											<h4 class="modal-title">{{ product.product_name }}</h4>
										  </div>
										  <div class="modal-body">
											<form action="https://km362.infusionsoft.com/app/manageCart/addProduct" target="_blank" class="product-options">
												<input type="hidden" name="productId" value="{{ product.id }}" />
												<input type="hidden" name="productOptionId" value="" />
												<input type="hidden" name="productOption" value="" />


												{% for option in product.product_options %}
													{% set option_key = "option-" ~ option.id %}

													<div class="form-group product-option-field">
														<label for="{{ option_key }}">{{ option.label }}</label>

														{% if option.type == 'FixedList' %}
															<select {% if option.required %}required{% endif %} class="form-control" id="{{ option_key }}" data-option-id="{{option.id}}">
																<option></option>
																{% for option_value in option.get('values') %}
																	<option value="{{option_value.id}}" {% if option_value.is_default %}selected{% endif %}>{{option_value.label}}</option>
																{% endfor %}
															</select>
														{% endif %}
														{% if option.type == 'Variable' or option.type == 'Date' %}
															<input {% if option.required %}required{% endif %} type="text" class="form-control {% if option.type == 'Date' %}date-picker {% if option.restrictions and 'weekdays-only' in option.restrictions %}weekdays-only{% endif %}  {% endif %}" id="{{ option_key }}" data-option-id="{{option.id}}" />
														{% endif %}
													</div>


												{% endfor %}

												<button type="submit" class="btn btn-primary"><i class="fa fa-shopping-basket " aria-hidden="true"></i>Add to Cart</button>
											</form>
										  </div>
										  <div class="modal-footer">
											<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
										  </div>
										</div>
									  </div>
									</div>
								</li>

								<!--
								WV:20170511:Commented out because we don't actually have any more information for this to link to at the moment
								<li><a href="course-single-left-sidebar.html" class="btn btn-link"><i class="fa fa-angle-double-right" aria-hidden="true"></i> More</a></li>
								-->
							</ul>
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	</div>
</section>


{% endblock %}
